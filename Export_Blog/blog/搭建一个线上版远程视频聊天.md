---
title:  搭建一个线上版远程视频聊天 
date:  2020-08-17 17:27:4805-1310-3008-1703-1207-0501-0408-0403-0702-0212-0408-0303-2403-1710-2607-1601-1908-1709-2201-31 
---
**目录**

[前言](#%E5%89%8D%E8%A8%80)

[搭建前端https访问：](#%E6%90%AD%E5%BB%BA%E5%89%8D%E7%AB%AFhttps%E8%AE%BF%E9%97%AE%EF%BC%9A)

[配置后端https请求：](#%E9%85%8D%E7%BD%AE%E5%90%8E%E7%AB%AFhttps%E8%AF%B7%E6%B1%82%EF%BC%9A)

---

## 前言

**在[另一篇博客](https://blog.csdn.net/time_____/article/details/104801205)中已经实现了远程视频聊天，然而这种方式只能运行在本地或者https服务下，因为navigator.mediaDevices.getUserMedia需要运行在安全模式下，所以这篇文章将对视频聊天做一个改进，达到真正的远程聊天功能  
之前的案例：[使用JS+socket.io+WebRTC+nodejs+express搭建一个简易版远程视频聊天](https://blog.csdn.net/time_____/article/details/104801205)**

## **搭建前端https访问：**

搭建https的第一步得有一个服务器，相关的配置说明在我另一篇文章有提到  
**[案例：本地项目上线流程](https://blog.csdn.net/time_____/article/details/104439713)**  
然后，购买域名并备案，第一次要久一点，大概20天左右  
在域名界面进行域名解析和ssl证书下载（后续配置https）  
![](https://img-blog.csdnimg.cn/20200817114950588.png)  
将域名绑定服务器外网ip

![](https://img-blog.csdnimg.cn/20200817115151901.png)  
域名界面点进管理，购买免费证书并下载，这里用的是Nginx  
![](https://img-blog.csdnimg.cn/20200817115741565.png?x-oss-processimage/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3RpbWVfX19fXw,size_16,color_FFFFFF,t_70)![](https://img-blog.csdnimg.cn/20200817115604189.png?x-oss-processimage/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3RpbWVfX19fXw,size_16,color_FFFFFF,t_70)![](https://img-blog.csdnimg.cn/20200817115910986.png?x-oss-processimage/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3RpbWVfX19fXw,size_16,color_FFFFFF,t_70)

把下载的key和pem放在Nginx根目录下，部署视频聊天前端文件夹Video至根目录，打开conf文件夹下的nginx.conf文件并编辑  
![](https://img-blog.csdnimg.cn/20200817152152668.png?x-oss-processimage/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3RpbWVfX19fXw,size_16,color_FFFFFF,t_70)![](https://img-blog.csdnimg.cn/20200817145531110.png?x-oss-processimage/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3RpbWVfX19fXw,size_16,color_FFFFFF,t_70)  
在nginx.conf文件中添加代码，代理Video文件夹下的video.html文件至12345端口

```
# Video
    server {
        listen       12345;
        server_name  localhost;
        location / {
            root   Video;
            index  video.html;
        }
    }
```

在nginx.conf文件中添加以下代码配置https证书，将上面的代理网站部署https证书

```
 # HTTPS server
    #
    server {
       listen       443  ssl;
       server_name  localhost;

       ssl_certificate      ../cert.pem;
       ssl_certificate_key  ../cert.key;

       ssl_session_cache    shared:SSL:1m;
       ssl_session_timeout  5m;

        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;
        ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
        ssl_prefer_server_ciphers on;

        location  /Video/{
           proxy_pass   http://127.0.0.1:12345/;
        }
    }
```

**最后通过访问[https://域名/Video/]()的方式打开前端页面**

## **配置后端https请求：**

将之前下载的证书文件复制到server目录，或者其他目录，server能访问到即可

![](https://img-blog.csdnimg.cn/20200817154313619.png)  
打开server修改代码，之前我们的写法是

```javascript
const express = require("express");
const app = express();
const server = require("http").Server(app);
const io = require("socket.io")(server);
```

现在得做个小修改，其他代码不动

```javascript
const express = require('express')
const app = express();
const fs = require('fs');
const options = {//读取证书文件
  key: fs.readFileSync('cert.key'),
  cert: fs.readFileSync('cert.pem')
};
const server = require('https').createServer(options,app);
const io = require('socket.io')(server);
```

**后端修改成https的目的**是因为前端部分放在https服务器上，而后端用http请求方式，浏览器会报http的请求错误  
![](https://img-blog.csdnimg.cn/20200817160942504.png)![](https://img-blog.csdnimg.cn/20200817160220448.png)

**然后把请求地址改为https即可访问**

**最后我们看看效果  
由于电脑上的摄像头无法被两个页面调用，所以我用手机和电脑进行远程视频  
电脑端的录屏**  
![](https://img-blog.csdnimg.cn/20200817171142829.gif)  
**手机端录屏**  
![](https://img-blog.csdnimg.cn/20200817171521268.gif)  
**总结：由于视频聊天涉及隐私问题，自己试着研究一下还可以，所以就不放案例试用链接，[之前的视频聊天案例](https://gitee.com/DieHunter/myCode/tree/master/videoSteam)**